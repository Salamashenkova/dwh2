# ddl_config.yaml → Data Vault 2.0 (HUB/SAT/LINK по схеме микросервисов)
ddl_config:
  # ========================================
  # USER_SERVICE (user_service_db.public.USERS)
  # ========================================
  user_service_public_USERS:
    type: hub
    table: hub_user
    schema: dwh_detailed
    business_key: user_external_id
    source_system: user_service
    hash_key: hk_user

  user_service_public_USERS_sat:
    type: sat
    table: sat_user
    schema: dwh_detailed
    business_key: user_external_id
    source_system: user_service
    hash_key: hk_user
    attributes:
      - email
      - first_name
      - last_name
      - phone
      - date_of_birth
      - registration_date
      - status
      - effective_from
      - effective_to
      - is_current
      - created_at
      - updated_at
      - created_by
      - updated_by

  # ========================================
  # ORDER_SERVICE (order_service_db.public.ORDERS)
  # ========================================
  order_service_public_ORDERS:
    type: hub
    table: hub_order
    schema: dwh_detailed
    business_key: order_external_id
    source_system: order_service
    hash_key: hk_order

  order_service_public_ORDERS_sat:
    type: sat
    table: sat_order
    schema: dwh_detailed
    business_key: order_external_id
    source_system: order_service
    hash_key: hk_order
    attributes:
      - user_external_id
      - order_date
      - subtotal
      - tax_amount
      - shipping_cost
      - discount_amount
      - total_amount
      - currency
      - status
      - payment_method
      - payment_status
      - effective_from
      - effective_to
      - is_current
      - created_at
      - updated_at
      - created_by
      - updated_by

  # ========================================
  # LOGISTICS_SERVICE (logistics_service_db.public.SHIPMENTS)
  # ========================================
  logistics_service_public_SHIPMENTS:
    type: hub
    table: hub_shipment
    schema: dwh_detailed
    business_key: shipment_external_id
    source_system: logistics_service
    hash_key: hk_shipment

  # ========================================
  # LINK (user ↔ order)
  # ========================================
  link_user_order:
    type: link
    table: link_user_order
    schema: dwh_detailed
    hash_key: hk_link_user_order
    parent_keys:
      - hub: hub_user
        key: hk_user
      - hub: hub_order
        key: hk_order
    source_system: order_service

  # ========================================
  # ADDITIONAL LINKS (будущие)
  # ========================================
  link_order_shipment:
    type: link
    table: link_order_shipment
    schema: dwh_detailed
    hash_key: hk_link_order_shipment
    parent_keys:
      - hub: hub_order
        key: hk_order
      - hub: hub_shipment
        key: hk_shipment
    source_system: logistics_service
